## 쿠버네티스란?

컨테이너화된 애플리케이션의 자동 배포, 확장 및 관리를 해주는 플랫폼으로 쉽게 말해 수많은 컨테이너를 관리하는 시스템이다.

## 쿠버네티스의 구조

### 쿠버네티스 클러스터

쿠버네티스 클러스터란 실행 중인 pod가 있는 하나 이상의 node 그룹이다.

쿠버네티스 클러스터는 크게 마스터 노드와 워커 노드로 구분된다.

개발자는 주로 마스터 노드와 통신하고, 사용자는 인터넷을 통해 워커 노드와 통신한다.

![구조1](/images/쿠버네티스구조1.png)

출처 : 한 권으로 배우는 도커 & 쿠버네티스

마스터 노드와 워커 노드 간의 유기적인 통신을 위해 CNI(Container Network Interfaces)를 사용한다.

### 컨트롤 플레인

쿠버네티스 마스터 노드는 컨트롤 플레인을 다룬다.

컨트롤 플레인이란 쿠버네티스 클러스터 전반의 작업을 관리하는 역할이다.

![구조2](/images/쿠버네티스구조2.png)

출처 : 한 권으로 배우는 도커 & 쿠버네티스

- API 서버
    - API 서버는 쿠버네티스 컨트롤 플레인에서의 프론트엔드 역할을 한다.
    - Kubectl 명령어를 통해 마스터 노드의 kube-apiserver에게 API 요청을 보낸다.
- ectd
    - 쿠버네티스 클러스에 존재하는 모든 데이터를 저장하는 key-value 저장소이다.
- 스케줄러
    - 새롭게 생성되는 pod를 어느 node에 실행시킬지 정하는 역할을 kube-scheduler가 수행한다.
- 컨트롤러 매니저
    - 쿠버네티스 리소스를 관리하고 제어하는 역할을 한다.
    - 컨트롤러는 마스터 노드에서 실해되며 클러스터 상태를 모니터링한다.
    - 컨트롤러에는 서비스 컨트롤러, RelicaSet 컨트롤러 등 여러 종류가 있으며 각 컨트롤러는 특정 리소스 타입을 관리한다.

### 노드

pod를 실행하는 머신으로 Amazon EC2 인스턴스와 같은 물리적 또는 가상 서버가 될 수 있다.

- Kubelet
    - 쿠버네티스 클러스터를 구성하는 각 node에는 Kubelet이 실행되며 Kubelet은 pod 내부의 컨테이너 실행을 담당한다.
    - pod의 상태를 모니터링하고, pod의 상태에 이상이 있다면 해당 pod를 다시 배포한다.
- Kube-Proxy
    - node에서 네트워크 역할을 수행한다.
    - node에 존재하는 pod들이 쿠버네티스 내부/외부와 네트워크 통신을 가능하게 한다.
- 컨테이너 런타임
    - 컨테이너의 생명주기를 담당한다.
    - 런타임 인터페이스 : Kubelet이 컨테이너 런타임과 통신할 때 사용한다. (containers, CRI-0 등)
- Pod
    - 컨테이너를 실행하기 위한 오브젝트로 한 개 이상의 컨테이너를 담을 수 있다.
    - 도커의 최소 실행 단위 : 컨테이너, 쿠버네티스의 최소 실행 단위 : pod
    - 도커에서는 컨테이너가 단독으로 실행되었지만 쿠버네티스에서는 컨테이너가 단독으로 실행하는 것이 아닌 pod 내에서 실행된다.
    - 하나의 pod는 하나의 node에서만 실행된다.
    - 하나의 pod에 속한 컨테이너들은 하나의 목적을 위해 구성된 컨테이너들이다.
    - 컨테이너처럼 일시적인 존재이므로 실행할 때마다 새로운 IP주소를 배정받는다.

### 워크로드

쿠버네티스에서 실행되는 애플리케이션이다.

워크로드가 하나의 컴포넌트 형태로 실행하든, 다수의 컴포넌트가 함께 실행하든 쿠버네티스는 pod 내부에서 워크로드를 실행하게 된다.

워크로드의 종류는 ReplicaSet, Deployment, StatefulSet, DaemonSet, Job, Cronjob이 있다.

- ReplicaSet
    - pod의 복제를 관리하며 클라이언트가 요구하는 복제본 개수만큼 pod를 복제하고 모니터링하고 관리한다.
- Deployment
    - 애플리케이션의 배포와 스케일링을 관리한다.
- StatefulSet
    - pod 사이에서 순서ㅘ 고유성이 보장되어야 하는 경우 사용한다.
- DaemonSet
    - 쿠버네티스를 구성하는 모든 node가 pod의 복사본을 실행하도록 한다.
    - 로깅, 모니터링, 스토리지 등과 같은 시스템 수준의 서비스를 실행하는 데 사용한다.
- Job & Cronjob
    - 정상적으로 완료되고 종료되는 것을 담당한다. 만약, pod가 정상적으로 종료되지 않는다면 재실행시킨다.

### 네트워크

- 서비스
    - 쿠버네티스의 서비스를 사용하면 pod를 여러 개 묶어서 클러스터 외부로 노출시킬 수 있다.
    - 이미 실행 중인 pod를 외부로 노출시키기 위해 pod 내부를 수정할 필요가 없기 때문에 실행 중인 pod 수정 없이도 외부에 노출시켜 클라이언트와 통신할 수 있다.
- 인그레스
    - 쿠버네티스 내부에 존재하는 서비스를 HTTP/HTTPS 루트를 클러스터 외부로 라우팅하는 역할을 한다.

### 스토리지

컨테이너가 삭제되거나 재실행되면 해당 컨테이너 내부에 존재하는 파일은 모두 삭제되는데 쿠버네티스 스토리지를 활용하면 pod의 상태와 상관없이 파일을 보관할 수 있다.